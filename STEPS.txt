apt update && apt -y upgrade && apt install -y sudo  nginx mariadb-server mariadb-client wget lsb-release apt-transport-https ca-certificates  curl  -y &&
 wget -O /etc/apt/trusted.gpg.d/php.gpg https://packages.sury.org/php/apt.gpg && echo "deb https://packages.sury.org/php/ $(lsb_release -sc) main" | sudo tee /etc/apt/sources.list.d/php.list 
 && apt update && apt upgrade -y && apt -y install php-fpm  && service php8.1-fpm start 
 && service  mysql restart && curl -O https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar && php wp-cli.phar --info && chmod +x wp-cli.phar && sudo mv wp-cli.phar /usr/local/bin/wp 
 && apt install -y php-mysql && service php8.1-fpm restart
 



CREATE DATABASE;

mysql -u root -p

CREATE DATABASE wordpress_db;

GRANT ALL ON wordpress_db.* TO 'wpuser'@'%' IDENTIFIED BY 'otman' WITH GRANT OPTION;

FLUSH PRIVILEGES;exit;



INSTALL WORDPRESS;

mkdir /var/www/wordpress && cd /var/www/wordpress/ && wp core download --allow-root


CONFIG NGINX;

sudo vim /etc/nginx/sites-available/wordpress.conf

sudo ln -s /etc/nginx/sites-available/wordpress.conf /etc/nginx/sites-enabled/wordpress.conf

rm -rf /etc/nginx/sites-enabled/default





COFIG FPM:

sed -i 's+/run/php/php7.3-fpm.sock+0.0.0.0:9000+g' /etc/php/7.3/fpm/pool.d/www.conf


CONFIG WOPDPRESS:



wp core config --path=/var/www/wordpress --dbname=wordpress_db --dbuser=wpuser --dbpass=otman --dbhost=$DB_HOST --allow-root

wp core install --url=oagrram.42.fr --title="ZABOB LIL AKHBAR" --admin_name=otman --admin_password=otman --admin_email=otman@gmail.com --allow-root



 



Rm default in /etc/nginx/site* and create a link in /etc/nginx/site-enable pointed to avalbibel.conf

DOMAINE NAME oagrram.42.fr





















CONFIG SITE AVAUALBEL :

server {
	listen 80 default_server;
	listen [::]:80 default_server;
	root /var/www/wordpress;

	index index.php index.html index.htm;

	server_name _;

	location / {
        	try_files $uri $uri/ /index.php?$args;
   	 }

   	location ~ \.php$ {
        try_files $uri =404;
	fastcgi_split_path_info ^(.+\.php)(/.+)$;
        fastcgi_pass unix:/run/php/php7.4-fpm.sock;
        fastcgi_index index.php;
        include fastcgi_params;
    }
}


server {
    listen 443 ssl http2 ;
    ssl_certificate /etc/ssl/inception.crt;
     ssl_certificate_key /etc/ssl/inception.key;
    root /var/www/wordpress;
    index index.php index.html index.htm;
    ssl_protocols  TLSv1.2;
    access_log /var/log/nginx/wordpress_access.log;
    error_log /var/log/nginx/wordpress_error.log;

location / {
        try_files $uri $uri/ /index.php?$args;
        }

    location ~ .php$ {
        try_files $uri =404;
        include /etc/nginx/fastcgi_params;
        fastcgi_read_timeout 3600s;
        fastcgi_buffer_size 128k;
        fastcgi_buffers 4 128k;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_pass wordpress:9000;
        fastcgi_index index.php;
    }
}





TEST CONTAINERS


